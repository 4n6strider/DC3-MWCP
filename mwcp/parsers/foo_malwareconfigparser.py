"""This is an example parser used to show the different methods of adding data to the reporter."""
import os

from mwcp import Parser


class Foo(Parser):

    def __init__(self, reporter=None):
        Parser.__init__(self,
                        description='example parser that works on any file',
                        author='DC3',
                        reporter=reporter
                        )

    def run(self):

        # standardized metadata
        self.reporter.add_metadata("url", "http://127.0.0.1")

        # demonstrate access to sample
        self.reporter.debug("size of inputfile is %i bytes" %
                            (len(self.reporter.data)))

        # other, non-standardized metadata
        # also demonstrate use of pefile object
        if self.reporter.pe:
            self.reporter.add_metadata(
                "other", {"section0": self.reporter.pe.sections[0].Name.rstrip('\x00')})

        # demonstrate file output
        self.reporter.output_file(
            b"hello world", "fooconfigtest.txt", "example output file")

        # demonstrate use of filename()
        self.reporter.debug("operating on inputfile %s" %
                            self.reporter.filename())

        # demonstrate use of managed tempdir
        with open(os.path.join(self.reporter.managed_tempdir(), "footmp.txt"), "w") as f:
            f.write("This is a temp file created in a directory that will be managed by the mwcp framework. \
                The directory will initially be empty, so there is no worry about name collisions. \
                The directory is deleted after this module run ends, unless tempcleanup is disabled.")
